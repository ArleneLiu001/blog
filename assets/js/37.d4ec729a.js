(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{381:function(s,t,a){"use strict";a.r(t);var e=a(18),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"cookie-session"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cookie-session"}},[s._v("#")]),s._v(" cookie&session")]),s._v(" "),t("h4",{attrs:{id:"cookie特点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cookie特点"}},[s._v("#")]),s._v(" cookie特点")]),s._v(" "),t("ol",[t("li",[s._v("结构化数据")]),s._v(" "),t("li",[s._v("每次发送http请求，会将请求域的cookie一起发送给server")]),s._v(" "),t("li",[s._v("server可以修改cookie，并返回给浏览器")]),s._v(" "),t("li",[s._v("浏览器端也可以修改cookie(有限制)")])]),s._v(" "),t("h4",{attrs:{id:"sever端nodejs操作cookie"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sever端nodejs操作cookie"}},[s._v("#")]),s._v(" sever端nodejs操作cookie")]),s._v(" "),t("p",[s._v("获取：req.headers.cookie || ''\n设置：res.setHeader('Set-Cookie',"),t("code",[s._v("username=${data.username};path=/")]),s._v(")\n//path生效路由。")]),s._v(" "),t("h4",{attrs:{id:"cookie做限制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cookie做限制"}},[s._v("#")]),s._v(" cookie做限制")]),s._v(" "),t("p",[s._v("res.setHeader('Set-Cookie',"),t("code",[s._v("username=${data.username};path=/")]),s._v(",httpOnly)\nhttpOnly:限制只能后端来改，前端不能修改。\n过期时间设置：")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getExpireTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" newday "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Date")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    newday"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newday"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" newday"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toGMTString")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nres"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setHeader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Set-Cookie'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token template-string"}},[t("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("username=")]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v(";path=/")]),t("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("httpOnly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("expires"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getExpireTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h4",{attrs:{id:"session"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#session"}},[s._v("#")]),s._v(" session")]),s._v(" "),t("p",[s._v("使用cookie设置username会非常危险，解决方法：cookie中存储userid，server端对应username。\n问题：")]),s._v(" "),t("ol",[t("li",[s._v("目前session直接是js变量，放在nodejs进程内存中，进程内存有限，访问量过大会有问题。")]),s._v(" "),t("li",[s._v("正式显示运行是多进程，进程之间内存无法共享。")])]),s._v(" "),t("h4",{attrs:{id:"redis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[s._v("#")]),s._v(" redis")]),s._v(" "),t("p",[s._v("解决方式：\n特点：1.web\n1.web server最常用的缓存数据库，数据存放在内存中。\n2. 相比于mysql，速度更快。\n3. 但是成本更高，可存储的数据量更小。")]),s._v(" "),t("h4",{attrs:{id:"为何session适合用redis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为何session适合用redis"}},[s._v("#")]),s._v(" 为何session适合用redis：")]),s._v(" "),t("ol",[t("li",[s._v("session访问频繁。对性能要求高。")]),s._v(" "),t("li",[s._v("session可不考虑断电丢失数据的问题")]),s._v(" "),t("li",[s._v("session数据量不会太大。")])])])}),[],!1,null,null,null);t.default=n.exports}}]);